import{a as f}from"./chunk-H24DLGSG.js";import{G as p,K as c,N as u,ac as h,ec as R,l as n,w as a}from"./chunk-IU75DD4N.js";var m=class o{constructor(e,t){this.auth=e;this.router=t}isRefreshing=!1;intercept(e,t){if(console.log("%c[CUSTOMER INTERCEPTOR] Aktif","color: limegreen; font-weight: bold;"),!e.url.startsWith(`${R.apiUrl}/api/customer`))return t.handle(e);let i=this.auth.token,s=e;return i?(console.log("[CUSTOMER INTERCEPTOR] Token bulundu, header eklendi:",i),s=e.clone({setHeaders:{Authorization:`Bearer ${i}`}})):console.warn("[CUSTOMER INTERCEPTOR] Token bulunamad\u0131, \xE7\u0131plak istek gidiyor:",e.url),t.handle(s).pipe(a(l=>l.status===401&&!this.isRefreshing?(console.warn("[CUSTOMER INTERCEPTOR] 401 al\u0131nd\u0131, refresh deneniyor..."),this.isRefreshing=!0,this.auth.refresh().pipe(p(()=>{this.isRefreshing=!1;let r=this.auth.token;console.log("[CUSTOMER INTERCEPTOR] Refresh ba\u015Far\u0131l\u0131, yeni token:",r);let E=s.clone({setHeaders:{Authorization:`Bearer ${r}`}});return t.handle(E)}),a(r=>(console.error("[CUSTOMER INTERCEPTOR] Refresh ba\u015Far\u0131s\u0131z \u2192 logout"),this.isRefreshing=!1,this.auth.logout().subscribe(()=>this.router.navigate(["/customer/login"])),n(()=>r))))):n(()=>l)))}static \u0275fac=function(t){return new(t||o)(u(f),u(h))};static \u0275prov=c({token:o,factory:o.\u0275fac})};export{m as a};
