import{Db as p,I as r,K as u,N as c,ec as h,i as s,k as l,l as a,w as n}from"./chunk-IU75DD4N.js";var g=class o{constructor(e){this.http=e}baseUrl=`${h.apiUrl}/api/customer/auth`;tokenKey="customerToken";profileKey="customerProfile";currentTokenSubject=new s(this.getToken());currentToken$=this.currentTokenSubject.asObservable();login(e,i){return this.http.post(`${this.baseUrl}/login`,{email:e,password:i},{withCredentials:!0}).pipe(r(t=>{console.log("\u{1F539} [Customer Login] Giri\u015F yan\u0131t\u0131:",t),t?.token?(localStorage.setItem("customerToken",t.token),localStorage.setItem("customerProfile",JSON.stringify(t.profile)),console.log("\u2705 [Customer Login] Token kaydedildi:",t.token),console.log("\u{1F464} [Customer Login] Profil:",t.profile)):console.warn("\u26A0\uFE0F [Customer Login] Token bulunamad\u0131!")}))}register(e){return this.http.post(`${this.baseUrl}/register`,e,{withCredentials:!0})}refresh(){return this.http.post(`${this.baseUrl}/refresh`,{},{withCredentials:!0}).pipe(r(e=>{e?.token&&this.setToken(e.token)}),n(e=>(console.warn("[CustomerAuthService] Refresh ba\u015Far\u0131s\u0131z \u2192 Oturum sonland\u0131r\u0131l\u0131yor"),this.clearSession(),a(()=>e))))}logout(){return this.http.post(`${this.baseUrl}/logout`,{},{withCredentials:!0}).pipe(r(()=>this.clearSession()),n(e=>(console.error("[CustomerAuthService] Logout hatas\u0131:",e),this.clearSession(),l(null))))}getToken(){return localStorage.getItem(this.tokenKey)}setToken(e){localStorage.setItem(this.tokenKey,e),this.currentTokenSubject.next(e)}get token(){return this.getToken()}get profile(){let e=localStorage.getItem(this.profileKey);return e?JSON.parse(e):null}isLoggedIn(){return!!this.getToken()}clearSession(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.profileKey),this.currentTokenSubject.next(null)}static \u0275fac=function(i){return new(i||o)(c(p))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};export{g as a};
